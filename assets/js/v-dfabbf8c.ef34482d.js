"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[518],{2946:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-dfabbf8c",path:"/Other/WebHook.html",title:"宝塔面板自动同步gitee仓库代码",lang:"zh-CN",frontmatter:{date:"2021/11/24",categories:["服务端"],tag:["宝塔面板","同步代码"]},excerpt:"",headers:[{level:2,title:"步骤",slug:"步骤",children:[{level:3,title:"前置条件：",slug:"前置条件",children:[]},{level:3,title:"第一步：",slug:"第一步",children:[]},{level:3,title:"第二步：",slug:"第二步",children:[]},{level:3,title:"第三步：",slug:"第三步",children:[]},{level:3,title:"第四步：",slug:"第四步",children:[]},{level:3,title:"第五步：",slug:"第五步",children:[]},{level:3,title:"第六步：",slug:"第六步",children:[]},{level:3,title:"Q&A：",slug:"q-a",children:[]}]}],filePathRelative:"Other/WebHook.md",git:{updatedTime:1638239157e3,contributors:[{name:"冉勇",email:"1311518086@qq.com",commits:1}]}}},1449:(n,s,a)=>{a.r(s),a.d(s,{default:()=>R});var e=a(6252);const t=(0,e.uE)('<h1 id="宝塔面板自动同步gitee仓库代码" tabindex="-1"><a class="header-anchor" href="#宝塔面板自动同步gitee仓库代码" aria-hidden="true">#</a> 宝塔面板自动同步gitee仓库代码</h1><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>本想弄宝塔的gitlab进行代码同步的，发现自己的服务器太小了，下载gitlab就占了80%的内存了，后面发现网上有webhook这个东西，于是就有了这个方案。</p></div><h2 id="步骤" tabindex="-1"><a class="header-anchor" href="#步骤" aria-hidden="true">#</a> 步骤</h2><h3 id="前置条件" tabindex="-1"><a class="header-anchor" href="#前置条件" aria-hidden="true">#</a> 前置条件：</h3><p>需要进入shell终端生成ssh公钥</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ssh-keygen -t rsa\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/.ssh\n<span class="token function">ls</span>\n<span class="token function">cat</span> id_rsa.pub\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>复制这个公钥</code></p>',8),l=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124105925255",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124105925.png",data:"aurora"})],-1),p=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124110027214",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124110027.png",data:"aurora"})],-1),o=(0,e._)("h3",{id:"第一步",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#第一步","aria-hidden":"true"},"#"),(0,e.Uk)(" 第一步：")],-1),i=(0,e._)("p",null,[(0,e._)("code",null,"进入宝塔面板"),(0,e.Uk)("-"),(0,e._)("code",null,"软件商店"),(0,e.Uk)("-"),(0,e._)("code",null,"搜索【webhook】")],-1),c=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124103919927",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124103935.png",data:"aurora"})],-1),r=(0,e._)("h3",{id:"第二步",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#第二步","aria-hidden":"true"},"#"),(0,e.Uk)(" 第二步：")],-1),u=(0,e._)("p",null,[(0,e._)("code",null,"打开宝塔WebHook")],-1),b=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124104108746",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124104108.png",data:"aurora"})],-1),g=(0,e.uE)('<p><code>脚本语言:</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>\n \n<span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>\n<span class="token comment">#输出当前时间</span>\n<span class="token function">date</span> --date<span class="token operator">=</span><span class="token string">&#39;0 days ago&#39;</span> <span class="token string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>\n<span class="token builtin class-name">echo</span> <span class="token string">&quot;Start&quot;</span>\n<span class="token comment">#判断宝塔WebHook参数是否存在</span>\n<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">then</span> \n          <span class="token builtin class-name">echo</span> <span class="token string">&quot;param参数错误&quot;</span>\n          <span class="token builtin class-name">echo</span> <span class="token string">&quot;End&quot;</span>\n          <span class="token builtin class-name">exit</span>\n<span class="token keyword">fi</span>\n<span class="token comment">#git项目路径</span>\n<span class="token assign-left variable">gitPath</span><span class="token operator">=</span><span class="token string">&quot;/www/wwwroot/<span class="token variable">$1</span>&quot;</span>\n<span class="token comment">#git 网址</span>\n<span class="token assign-left variable">gitHttp</span><span class="token operator">=</span><span class="token string">&quot;https://gitee.com/你的gitee用户名“例如：【ranyong】”/<span class="token variable">$1</span>.git&quot;</span> //自己仓库的链接\n<span class="token builtin class-name">echo</span> <span class="token string">&quot;Web站点路径：<span class="token variable">$gitPath</span>&quot;</span>\n<span class="token comment">#判断项目路径是否存在</span>\n<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$gitPath</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">cd</span> <span class="token variable">$gitPath</span>\n        <span class="token comment">#判断是否存在git目录</span>\n        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;.git&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n                <span class="token builtin class-name">echo</span> <span class="token string">&quot;在该目录下克隆 git&quot;</span>\n                <span class="token function">sudo</span> <span class="token function">git</span> clone <span class="token variable">$gitHttp</span> gittemp\n                <span class="token function">sudo</span> <span class="token function">mv</span> gittemp/.git <span class="token builtin class-name">.</span>\n                <span class="token function">sudo</span> <span class="token function">rm</span> -rf gittemp\n        <span class="token keyword">fi</span>\n        <span class="token builtin class-name">echo</span> <span class="token string">&quot;拉取最新的项目文件&quot;</span>\n        <span class="token comment">#sudo git reset --hard origin/master</span>\n        <span class="token function">sudo</span> <span class="token function">git</span> pull        \n        <span class="token builtin class-name">echo</span> <span class="token string">&quot;设置目录权限&quot;</span>\n        <span class="token function">sudo</span> <span class="token function">chown</span> -R www:www <span class="token variable">$gitPath</span>\n        <span class="token builtin class-name">echo</span> <span class="token string">&quot;End&quot;</span>\n        <span class="token builtin class-name">exit</span>\n<span class="token keyword">else</span>\n        <span class="token builtin class-name">echo</span> <span class="token string">&quot;该项目路径不存在&quot;</span>\n                <span class="token builtin class-name">echo</span> <span class="token string">&quot;新建项目目录&quot;</span>\n        <span class="token function">mkdir</span> <span class="token variable">$gitPath</span>\n        <span class="token builtin class-name">cd</span> <span class="token variable">$gitPath</span>\n        <span class="token comment">#判断是否存在git目录</span>\n        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;.git&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n                <span class="token builtin class-name">echo</span> <span class="token string">&quot;在该目录下克隆 git&quot;</span>\n                <span class="token function">sudo</span> <span class="token function">git</span> clone <span class="token variable">$gitHttp</span> gittemp\n                <span class="token function">sudo</span> <span class="token function">mv</span> gittemp/.git <span class="token builtin class-name">.</span>\n                <span class="token function">sudo</span> <span class="token function">rm</span> -rf gittemp\n        <span class="token keyword">fi</span>\n        <span class="token builtin class-name">echo</span> <span class="token string">&quot;拉取最新的项目文件&quot;</span>\n        <span class="token comment">#sudo git reset --hard origin/master</span>\n        <span class="token function">sudo</span> <span class="token function">git</span> pull\n        <span class="token builtin class-name">echo</span> <span class="token string">&quot;设置目录权限&quot;</span>\n        <span class="token function">sudo</span> <span class="token function">chown</span> -R www:www <span class="token variable">$gitPath</span>\n        <span class="token builtin class-name">echo</span> <span class="token string">&quot;End&quot;</span>\n        <span class="token builtin class-name">exit</span>\n<span class="token keyword">fi</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="第三步" tabindex="-1"><a class="header-anchor" href="#第三步" aria-hidden="true">#</a> 第三步：</h3><p><code>查看密钥</code></p>',4),m=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124104516629",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124104516.png",data:"aurora"})],-1),d=(0,e._)("p",null,[(0,e._)("code",null,"可以看到如图的例子")],-1),k=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124104602285",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124104602.png",data:"aurora"})],-1),h=(0,e._)("h3",{id:"第四步",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#第四步","aria-hidden":"true"},"#"),(0,e.Uk)(" 第四步：")],-1),w=(0,e._)("p",null,[(0,e._)("code",null,"来到你的gitee仓库")],-1),f=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124104706597",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124104706.png",data:"aurora"})],-1),_=(0,e._)("p",null,[(0,e._)("code",null,"点击管理-WebHooks-添加webHook")],-1),v=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124104753043",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124104753.png",data:"aurora"})],-1),q=(0,e._)("p",null,[(0,e._)("code",null,"将刚刚的密钥填入")],-1),y=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124104940833",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124104940.png",data:"aurora"})],-1),z=(0,e._)("p",null,[(0,e._)("code",null,"修改一个参数")],-1),x=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124105114619",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124105114.png",data:"aurora"})],-1),S=(0,e.uE)('<p>点击添加即可</p><h3 id="第五步" tabindex="-1"><a class="header-anchor" href="#第五步" aria-hidden="true">#</a> 第五步：</h3><p>回到宝塔面板，进入到<code>/www/wwwroot</code>目录，克隆你的仓库。可能会让你输入密码</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /www/wwwroot\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> clone https://gitee.com/ran_yong/test-hook.git\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',5),j=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124105459467",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124105459.png",data:"aurora"})],-1),$=(0,e._)("h3",{id:"第六步",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#第六步","aria-hidden":"true"},"#"),(0,e.Uk)(" 第六步：")],-1),H=(0,e._)("p",null,[(0,e._)("code",null,"测试一下")],-1),P=(0,e._)("p",null,"在gitee初始化一个README.md文件",-1),E=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124110759991",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124110800.png",data:"aurora"})],-1),U=(0,e._)("p",null,[(0,e._)("img",{src:"https://ooszy.cco.vin/img/blog-public/ljz.gif",alt:"image-20211124110839175",originSrc:"https://gitee.com/ran_yong/mark-down-table-upload/raw/master/img/20211124110839.png",data:"aurora"})],-1),W=(0,e.uE)('<h3 id="q-a" tabindex="-1"><a class="header-anchor" href="#q-a" aria-hidden="true">#</a> Q&amp;A：</h3><p>Q1：如果没拉取成功怎么办？</p><p>A：生成ssh公钥后，可以尝试重启下宝塔面板</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/etc/init.d/bt restart\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',4),A={},R=(0,a(3744).Z)(A,[["render",function(n,s){return(0,e.wg)(),(0,e.iD)(e.HY,null,[t,l,p,o,i,c,r,u,b,g,m,d,k,h,w,f,_,v,q,y,z,x,S,j,$,H,P,E,U,W],64)}]])}}]);